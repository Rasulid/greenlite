Для оптимальной схемы хранения данных в DynamoDB, учитывая заданную нагрузку и стоимость запросов, предлагается следующее решение:

Разбиение данных по пользователям:
Вам нужно хранить данные для каждого пользователя отдельно. Для этого используйте user_id как partition key.

Выбор временных интервалов для sort key:
Так как у вас есть 2880 значений activity_scores за сутки, вам нужно решить, какие временные интервалы будут использоваться в качестве sort key. Предлагается следующий вариант:

Разбить сутки на 24 часа (каждый час).
Для каждого часа создать отдельный документ с соответствующим unix timestamp (полученным из начала этого часа).
Таким образом, у вас будет 24 документа на пользователя за день.
Расчет размера документов:

Каждый документ будет иметь три атрибута: "u" (user_id), "t" (timestamp), "v" (список activity_scores).
Размер "u" и "t" можно считать как длину строки, представляющей числа, плюс размер числа самого.
Размер "v" можно рассчитать, как указано в справочной информации.
Расчет стоимости запросов:

Запись данных: С учетом размера документов, вы сможете рассчитать, сколько WRU (Write Request Units) потребуется на каждую запись. Это потребуется для каждого документа, который вы вставляете.
Чтение данных: При чтении данных за конкретный час или 12 часов вам придется читать соответствующие документы. Рассчитайте, сколько RRU (Read Request Units) потребуется на каждое чтение.
Оптимизация запросов на чтение:

При чтении данных за конкретные 12 часов, вы можете объединить запросы для каждого часа в один запрос. Это снизит количество RRU, потребуемых для чтения.
Используйте DynamoDB's BatchGetItem или другие оптимизации для снижения стоимости чтения данных.
Пример кода функции convert_to_dynamodb_documents:

```
import datetime
from typing import List, Dict

def convert_to_dynamodb_documents(user_id: int, day: datetime.date, activity_scores: List[int]) -> List[Dict]:
    documents = []
    start_time = datetime.datetime(day.year, day.month, day.day, 0, 0, 0)
    
    for hour in range(24):
        timestamp = int((start_time + datetime.timedelta(hours=hour)).timestamp())
        doc = {"u": user_id, "t": timestamp, "v": activity_scores[hour * 120:(hour + 1) * 120]}
        documents.append(doc)
    
    return documents
```

Оценка стоимости:
Для точной оценки стоимости вам потребуется рассчитать размер каждого документа и количество запросов на чтение и запись, и затем применить указанные цены WRU и RRU.



Для того чтобы рассчитать стоимость, нам нужно определить размер документа и количество запросов на запись и чтение. Давайте сначала рассчитаем размер документа.

Размер документа:

"u" (user_id): Это целое число от 1 до 1,000,000. Давайте предположим, что его размер составляет 4 байта.
"t" (timestamp): Это целое число в формате Unix timestamp. Размер такого числа составляет 4 байта.
"v" (список activity_scores): Размер этого списка мы рассчитали ранее в справочной информации. Давайте предположим, что он составляет 13 байт.
Общий размер документа: 4 байта + 4 байта + 13 байт = 21 байт.
Количество запросов на запись:

У нас есть 24 часа в сутки, и для каждого часа мы создаем один документ для каждого пользователя. Поэтому количество записей в день для одного пользователя составляет 24.
У вас есть 1,000,000 пользователей, поэтому общее количество записей в день составляет 24 * 1,000,000 = 24,000,000 записей в день.
Если мы рассчитываем стоимость на месяц (30 дней), то это будет 30 * 24,000,000 = 720,000,000 записей в месяц.
Количество запросов на чтение:

У вас есть 2 запроса на чтение на пользователя в день: получение списка activity_scores за конкретный час и получение списка activity_scores за конкретные 12 часов.
Это также умножается на количество пользователей. То есть, в день у вас есть 2 * 1,000,000 = 2,000,000 запросов на чтение.
Если мы рассчитываем стоимость на месяц (30 дней), то это будет 30 * 2,000,000 = 60,000,000 запросов на чтение в месяц.
Стоимость записи:

Запись 1 документа размером 21 байт в DynamoDB стоит 1 WRU.
Мы рассчитали, что у нас есть 720,000,000 записей в месяц.
Поэтому стоимость записи в месяц составляет 720,000,000 WRU.
Стоимость чтения:

Чтение 1 документа размером до 4 КБ стоит 1 RRU.
Мы предположили, что документы будут менее 4 КБ.
Мы рассчитали, что у нас есть 60,000,000 запросов на чтение в месяц.
Поэтому стоимость чтения в месяц составляет 60,000,000 RRU.
Теперь, чтобы рассчитать стоимость в долларах, вам нужно умножить количество WRU и RRU на соответствующие цены:

Стоимость записи в месяц = 720,000,000 WRU * ($1.25 / 1,000,000 WRU) = $900.
Стоимость чтения в месяц = 60,000,000 RRU * ($0.25 / 1,000,000 RRU) = $15.
Таким образом, общая стоимость чтения и записи в месяц составляет $915.

Обратите внимание, что это приблизительная оценка и фактическая стоимость может варьироваться в зависимости от конфигурации и настроек вашей базы данных DynamoDB.





